airsonic:
  controller:
    labels:
      nfs: "true"


  image:
    repository: airsonicadvanced/airsonic-advanced
    tag: latest@sha256:9c87ad489eee4a15e23d509f27f373d8b816a880f941fdaa46c2eb5d461b4aa2

  env:
    TZ: America/New_York
    PUID: 1000
    PGID: 1000
    JAVA_OPTS: -Dserver.forward-headers-strategy=native

  persistence:
    config:
      enabled: true
      retain: true
      size: 256Mi
      mountPath: /var/airsonic
      accessMode: ReadWriteOnce
      storageClass: longhorn
    music:
      enabled: true
      readOnly: true
      type: custom
      volumeSpec:
        nfs:
          server: 192.168.1.91
          path: /mnt/storage/music/beets/Music
    playlists:
      enabled: true
      readOnly: true
      type: custom
      volumeSpec:
        nfs:
          server: 192.168.1.91
          path: /mnt/storage/music/beets/Music/playlists
    podcasts:
      enabled: true
      readOnly: true
      type: custom
      volumeSpec:
        nfs:
          server: 192.168.1.91
          path: /mnt/storage/podcasts

  ingress:
    main:
      enabled: true
      annotations:
      hosts:
      - host: as.w00t.cloud
        paths:
        - path: /
          pathType: Prefix

  initContainers:
    duplicacy-init:
      image: alexphillips/duplicacy-init
      env:
        - name: BACKUP_NAME
          value: gcd-airsonic
        - name: BACKUP_LOCATION
          value: gcd://duplicacy_backup/airsonic
        - name: DUPLICACY_PASSWORD
          valueFrom:
            secretKeyRef:
              name: duplicacy
              key: password
        - name: GCD_TOKEN
          valueFrom:
            secretKeyRef:
              name: duplicacy
              key: gcd_token
      volumeMounts:
        - mountPath: /data
          name: config

  additionalContainers:
    duplicacy-backup:
      image: alexphillips/duplicacy-backup
      env:
        - name: SCHEDULE
          value: "0 20 * * *"
        - name: HC_API_URL
          value: https://hc.w00t.cloud/ping
        - name: CHECK_UUID
          value: 52150d16-2eb3-44e8-bc41-80274a5cfb86
        - name: DUPLICACY_PASSWORD
          valueFrom:
            secretKeyRef:
              name: duplicacy
              key: password
        - name: GCD_TOKEN
          valueFrom:
            secretKeyRef:
              name: duplicacy
              key: gcd_token
      volumeMounts:
        - mountPath: /data
          name: config
